!function(){function t(t){var e=new Image;return e.src=t.toDataURL("image/jpeg"),e}function e(t){var e=(t.naturalWidth,t.naturalHeight),a=document.createElement("canvas");a.width=1,a.height=e;var r=a.getContext("2d");r.drawImage(t,0,0);for(var n=r.getImageData(0,0,1,e).data,i=0,o=e,g=e;g>i;){var s=n[4*(g-1)+3];0===s?o=g:i=g,g=o+i>>1}var c=g/e;return 0===c?1:c}function a(t,a,r,n,i,o,g,s,c,u){var d=e(a);t.drawImage(a,r*d,n*d,i*d,o*d,g,s,c,u)}window.compressImg=function(e,r,n){var i=document.getElementById(e),o=document.getElementById(r),g=document.createElement("canvas"),s=o.src;if(g.getContext)var c=g.getContext("2d");else alert("对不起，您的浏览器不支持图片压缩及上传功能，请换个浏览器试试~");i.addEventListener("change",function(){var e=this,r=new Image,i=new FileReader;i.onload=function(i){var u=i.target.result;r.src="image"!=u.substring(5,10)?u.replace(/(.{5})/,"$1image/jpeg;"):u,r.onload=function(){var i=r.width,u=r.height,d=1;EXIF.getData(r,function(){d=parseInt(EXIF.getTag(r,"Orientation")),d=d?d:1});var l=n*u/i;return 10>i||10>i?(alert("请不要上传过小的图片"),o.src=s,e.value="",!1):(4>=d?(g.setAttribute("height",l),g.setAttribute("width",n),(3==d||4==d)&&(c.translate(n,l),c.rotate(180*Math.PI/180))):(g.setAttribute("height",n),g.setAttribute("width",l),5==d||6==d?(c.translate(l,0),c.rotate(90*Math.PI/180)):(7==d||8==d)&&(c.translate(0,n),c.rotate(270*Math.PI/180))),a(c,r,0,0,i,u,0,0,n,l),o.src=t(g).src,e.value="",void 0)}},i.readAsDataURL(this.files[0])},!1)}}();