!function(){function e(e){var t=new Image;return t.src=e.toDataURL("image/jpeg"),t}function t(e){var t=(e.naturalWidth,e.naturalHeight),n=document.createElement("canvas");n.width=1,n.height=t;var r=n.getContext("2d");r.drawImage(e,0,0);for(var a=r.getImageData(0,0,1,t).data,i=0,o=t,s=t;s>i;){var l=a[4*(s-1)+3];0===l?o=s:i=s,s=o+i>>1}var u=s/t;return 0===u?1:u}function n(e,n,r,a,i,o,s,l,u,c){var d=t(n);e.drawImage(n,r*d,a*d,i*d,o*d,s,l,u,c)}window.compressImg=function(t,r,a){var i=document.getElementById(t),o=document.getElementById(r),s=document.createElement("canvas"),l=o.src;if(s.getContext)var u=s.getContext("2d");else alert("对不起，您的浏览器不支持图片压缩及上传功能，请换个浏览器试试~");i.addEventListener("change",function(){var t=this,r=new Image,i=new FileReader;i.onload=function(i){var c=i.target.result;r.src="image"!=c.substring(5,10)?c.replace(/(.{5})/,"$1image/jpeg;"):c,r.onload=function(){var i=r.width,c=r.height,d=1;EXIF.getData(r,function(){d=parseInt(EXIF.getTag(r,"Orientation")),d=d?d:1});var g=a*c/i;return 10>i||10>i?(alert("请不要上传过小的图片"),o.src=l,t.value="",!1):(4>=d?(s.setAttribute("height",g),s.setAttribute("width",a),(3==d||4==d)&&(u.translate(a,g),u.rotate(180*Math.PI/180))):(s.setAttribute("height",a),s.setAttribute("width",g),5==d||6==d?(u.translate(g,0),u.rotate(90*Math.PI/180)):(7==d||8==d)&&(u.translate(0,a),u.rotate(270*Math.PI/180))),n(u,r,0,0,i,c,0,0,a,g),o.src=e(s).src,t.value="",void 0)}},i.readAsDataURL(this.files[0])},!1)}}();